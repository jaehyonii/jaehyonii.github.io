"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[171],{8171:function(e,t,a){a.r(t),a.d(t,{default:function(){return E}});var s=a(6768),r=a(4232),o=a(5130);const n={class:"main"},c={class:"product-grid"},l=["onClick"],i={class:"product-image"},p=["src"],h={key:1,class:"no-image"},u={class:"product-info"},d={key:1,class:"no-posts"},m={class:"search-container"};function g(e,t,a,g,v,y){return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",n,[t[3]||(t[3]=(0,s.Lk)("h1",null,"추천 상품",-1)),(0,s.Lk)("section",c,[y.posts.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(y.posts,((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"product-card",onClick:t=>y.redirectToRead(e.Ino)},[(0,s.Lk)("div",i,[e.Image?((0,s.uX)(),(0,s.CE)("img",{key:0,src:`data:image/jpeg;base64,${e.Image}`,alt:"상품 이미지"},null,8,p)):((0,s.uX)(),(0,s.CE)("div",h,"이미지 없음"))]),(0,s.Lk)("div",u,[(0,s.Lk)("h3",null,(0,r.v_)(e.Title),1),(0,s.Lk)("p",null,"가격: "+(0,r.v_)(e.Price)+"원",1),(0,s.Lk)("p",null,"찜: ❤ "+(0,r.v_)(e.Like_cnt),1),(0,s.Lk)("p",null," [지역: "+(0,r.v_)(e.Place)+" | 게시일: "+(0,r.v_)(y.formatDate(e.Reg_date))+" | 분류: "+(0,r.v_)(e.Group1)+"] ",1)])],8,l)))),128)):((0,s.uX)(),(0,s.CE)("div",d," 게시물이 없습니다. "))])]),(0,s.Lk)("div",m,[t[4]||(t[4]=(0,s.Lk)("h1",null,"내 주변의 판매 상품 보기",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>v.searchQuery=e),placeholder:"주소를 입력하세요",onKeyup:t[1]||(t[1]=(0,o.jR)(((...e)=>y.searchPlace&&y.searchPlace(...e)),["enter"]))},null,544),[[o.Jo,v.searchQuery]]),(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>y.searchPlace&&y.searchPlace(...e))},"검색")]),t[5]||(t[5]=(0,s.Lk)("div",{class:"map-container"},[(0,s.Lk)("div",{id:"map"})],-1))],64)}a(4114),a(8992),a(3949),a(1454);var v=a(4373),y=a(5068);let k=null,f=0,L=0;const P="oljo9cwscl";var C={computed:{posts(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return Array.isArray(this.allPosts)?this.allPosts.slice(e,t):[]}},data(){return{mainCategory:"",subCategory:"",priceFrom:null,priceTo:null,searchQuery:"",sortOption:"찜 많은 순",itemsPerPage:6,allPosts:[],currentPage:1,searchQuery:"",map:null,markers:[]}},beforeMount(){const e=document.createElement("script");e.src=`https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=${P}`,e.onload=this.initMap,e.onerror=()=>{console.error("네이버 지도 스크립트 로드 실패"),alert("네이버 지도 스크립트 로드 중 문제가 발생했습니다.")},document.head.appendChild(e)},methods:{async fetchPosts(){try{const e=await v.A.get("http://localhost:3000/search",{params:{mainCategory:this.mainCategory,subCategory:this.subCategory,priceFrom:this.priceFrom,priceTo:this.priceTo,searchQuery:this.searchQuery,sortOption:this.sortOption}});console.log("Axios 응답 데이터:",e.data),Array.isArray(e.data)?this.allPosts=e.data.map((e=>({...e,Reg_date:e.Reg_date}))):(console.error("응답 데이터가 배열이 아닙니다."),this.allPosts=[]),this.currentPage=1}catch(e){console.error("게시물 데이터를 가져오는 중 오류 발생:",e),this.allPosts=[]}},redirectToRead(e){this.$router.push(`/read/${e}`)},formatDate(e){const t={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(e).toLocaleDateString("ko-KR",t)},async initMap(){try{const e=localStorage.getItem("token");if(e){const t=(0,y.s)(e);console.log(t);const a=t.UserAddress;console.log(a);const s=await v.A.post("http://localhost:3000/map",{query:a});console.log(s);const{x:r,y:o}=s.data.location[0];k={X:parseFloat(o),Y:parseFloat(r)}}else f=37.619897,L=127.059542,k={X:f,Y:L}}catch(e){console.error("위치 정보를 로드하는 중 오류 발생:",e.message),k={X:37.619897,Y:127.059542}}"undefined"!==typeof naver?(this.map=new naver.maps.Map("map",{center:new naver.maps.LatLng(k.X,k.Y),zoom:16}),this.map.setZoom(16)):(console.error("네이버 지도 API 로드 실패"),alert("네이버 지도 API 로드 실패"));try{const t=await v.A.get("http://localhost:3000/map");console.log(t.data);for(let a of t.data.location)try{const{X:e,Y:t}=a,{Address:s}=a,{Ino:r,Title:o}=a,n=new naver.maps.InfoWindow({content:`\n                <div>\n                  <strong>주소:</strong> ${s}<br><strong>제목:</strong> ${o}\n                </div>\n              `,maxWidth:300}),c=new naver.maps.Marker({position:new naver.maps.LatLng(parseFloat(e),parseFloat(t)),map:this.map});naver.maps.Event.addListener(c,"mouseover",(()=>{n.open(this.map,c)})),naver.maps.Event.addListener(c,"mouseout",(()=>{n.close()})),naver.maps.Event.addListener(c,"click",(()=>{n.close();const e=`http://localhost:8080/read/${r}`;window.location.href=e})),this.markers.push(c)}catch(e){console.error(`마커 추가 실패: ${e.message}`)}}catch(e){return void(e.response&&404===e.response.status?console.error("Error: Resource not found (404)"):console.error("Error:",e.message))}},async searchPlace(){if(!localStorage.getItem("token"))return confirm("로그인이 필요합니다. \n로그인 페이지로 이동하시겠습니까?")?void this.$router.push({name:"login"}):void this.$router.push({name:"main"});if(!this.searchQuery.trim())return alert("검색어를 입력하세요.");console.log(this.searchQuery);try{const e=await v.A.post("http://localhost:3000/map/search",{query:this.searchQuery}),t=e.data.items;if(console.log(t),t.length>0){const e=t[0],a=new naver.maps.LatLng(parseFloat(e.mapy)/1e7,parseFloat(e.mapx)/1e7);this.map.setCenter(a),this.map.setZoom(16)}}catch(e){console.error("장소 검색 실패:",e.message),alert("검색 중 문제가 발생했습니다.")}},clearMarkers(){this.markers.forEach((e=>e.setMap(null))),this.markers=[]}},mounted(){this.fetchPosts()}},w=a(1241);const A=(0,w.A)(C,[["render",g],["__scopeId","data-v-1434bde1"]]);var E=A}}]);
//# sourceMappingURL=171.d98eb659.js.map