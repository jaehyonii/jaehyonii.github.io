"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[863],{3863:function(e,t,o){o.r(t),o.d(t,{default:function(){return C}});var r=o(6768),a=o(5130);const i={class:"form-container"},l={class:"form-group row"},n={class:"form-group row"},s={class:"form-group row"},p={class:"form-group row"},d={class:"photo-upload"},u={class:"photo-previews"},h=["src"],g={key:2},m=["src"],c={class:"form-actions"};function f(e,t,o,f,k,v){return(0,r.uX)(),(0,r.CE)("div",i,[t[12]||(t[12]=(0,r.Lk)("h2",{class:"form-title"},"게시글 수정",-1)),(0,r.Lk)("div",l,[t[8]||(t[8]=(0,r.Lk)("label",{for:"title"},"제목",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"title","onUpdate:modelValue":t[0]||(t[0]=e=>k.form.Title=e),placeholder:"제목을 입력하세요."},null,512),[[a.Jo,k.form.Title]])]),(0,r.Lk)("div",n,[t[9]||(t[9]=(0,r.Lk)("label",{for:"author"},"작성자",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"author","onUpdate:modelValue":t[1]||(t[1]=e=>k.form.Uid=e),disabled:""},null,512),[[a.Jo,k.form.Uid]])]),(0,r.Lk)("div",s,[t[10]||(t[10]=(0,r.Lk)("label",{for:"content"},"내용",-1)),(0,r.bo)((0,r.Lk)("textarea",{id:"content","onUpdate:modelValue":t[2]||(t[2]=e=>k.form.Content=e),placeholder:"내용을 입력하세요."},null,512),[[a.Jo,k.form.Content]])]),(0,r.Lk)("div",p,[t[11]||(t[11]=(0,r.Lk)("label",{for:"photos"},"이미지 업로드",-1)),(0,r.Lk)("div",d,[(0,r.Lk)("input",{type:"file",id:"photos",accept:"image/*",onChange:t[3]||(t[3]=(...e)=>v.handleFileUpload&&v.handleFileUpload(...e)),ref:"fileInput",style:{display:"none"}},null,544),(0,r.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>v.triggerFileInput&&v.triggerFileInput(...e))},"이미지 선택"),(0,r.Lk)("div",u,[k.previews.length?((0,r.uX)(),(0,r.CE)("img",{key:0,src:k.previews[0],alt:"미리보기 이미지",class:"preview-image"},null,8,h)):(0,r.Q3)("",!0),k.previews.length?((0,r.uX)(),(0,r.CE)("button",{key:1,onClick:t[5]||(t[5]=(...e)=>v.handleFileDelete&&v.handleFileDelete(...e))},"삭제")):k.originalImage?((0,r.uX)(),(0,r.CE)("div",g,[(0,r.Lk)("img",{src:k.originalImage,alt:"기존 이미지",class:"preview-image"},null,8,m),(0,r.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>v.handleFileDelete&&v.handleFileDelete(...e))},"삭제")])):(0,r.Q3)("",!0)])])]),(0,r.Lk)("div",c,[(0,r.Lk)("button",{class:"update",onClick:t[7]||(t[7]=(...e)=>v.updatePost&&v.updatePost(...e))},"수정하기")])])}o(4114),o(4603),o(7566),o(8721);var k=o(4373),v=o(5068),I={data(){return{form:{id:"",Title:"",Uid:"",Content:"",Notice:"0",Image:null},photos:[],previews:[],originalImage:null}},created(){const e=this.$route.query;this.form.Title=e.title||"",this.form.Uid=e.uid||"",this.form.Content=e.content||"",this.originalImage=e.images.length?e.images[0]:null;const t=localStorage.getItem("token");if(t)try{const e=(0,v.s)(t);e.userID!==this.form.Uid&&(alert("작성자만 게시글을 수정할 수 있습니다."),this.$router.push("/board/page_1"))}catch(o){console.error("JWT 디코딩 오류:",o),alert("로그인 정보가 유효하지 않습니다."),this.$router.push("/login")}else alert("로그인이 필요합니다."),this.$router.push("/login")},methods:{triggerFileInput(){this.$refs.fileInput.click()},handleFileUpload(e){const t=e.target.files[0];t&&t.type.startsWith("image/")?(this.photos=[t],this.previews=[URL.createObjectURL(t)],this.originalImage=null,this.form.Image=null):alert("이미지만 업로드할 수 있습니다.")},handleFileDelete(){this.photos=[],this.previews=[],this.originalImage=null,this.form.Image="delete"},async updatePost(){if(!this.form.Title.trim()||!this.form.Content.trim())return void alert("제목과 내용을 모두 입력해주세요.");const e=new Date;this.form.Reg_Date=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`;try{const e=new FormData;e.append("Uid",this.form.Uid),e.append("Reg_date",this.$route.query.regDate),e.append("Title",this.form.Title),e.append("Content",this.form.Content),e.append("New_Reg_date",this.form.Reg_Date),this.photos.length>0?e.append("Image",this.photos[0]):"delete"===this.form.Image?e.append("Image","delete"):this.originalImage?e.append("Image","original"):e.append("Image",null),await k.A.put("http://localhost:3000/updatepost",e,{headers:{"Content-Type":"multipart/form-data"}}),alert("게시글이 성공적으로 수정되었습니다."),this.$router.push({name:"ViewPost",query:{uid:this.form.Uid,regDate:this.form.Reg_Date}})}catch(t){console.error("게시글 수정 오류:",t.response?.data),alert(t.response?.data?.error||"게시글 수정 중 오류가 발생했습니다.")}}}},L=o(1241);const w=(0,L.A)(I,[["render",f],["__scopeId","data-v-8fe48f66"]]);var C=w}}]);
//# sourceMappingURL=863.4b211272.js.map